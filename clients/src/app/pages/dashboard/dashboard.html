<div class="flex h-screen bg-gray-50 dark:bg-gray-900 font-sans antialiased overflow-hidden">

    <!-- 1. Sidebar Fijo y Ocultable -->
    <aside class="fixed inset-y-0 left-0 z-30 overflow-y-auto bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 shadow-xl
           transition-all duration-300 ease-in-out flex flex-col" [class.w-64]="isSidebarOpen"
        [class.w-16]="!isSidebarOpen">

        <!-- Logo / T√≠tulo del Sistema -->
        <div class="flex items-center justify-center h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm relative">
            <h1 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400 tracking-wide transition-opacity duration-300"
                [class.opacity-100]="isSidebarOpen" [class.opacity-0]="!isSidebarOpen">GIMNASIO</h1>

            <!-- Icono visible cuando est√° colapsado -->
            <div [class.hidden]="isSidebarOpen" class="absolute inset-0 flex items-center justify-center">
                <svg class="h-6 w-6 text-indigo-600 dark:text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                </svg>
            </div>
        </div>

        <nav class="flex-1 flex flex-col space-y-1 overflow-x-hidden pt-4">

            <ng-container *ngFor="let item of navItems">
                <!-- M√≥dulos T√≠tulo -->
                <p *ngIf="item.isTitle"
                    class="text-xs font-semibold uppercase text-gray-400 dark:text-gray-500 py-2 pt-4 mx-4 transition-opacity duration-300"
                    [class.opacity-100]="isSidebarOpen" [class.opacity-0]="!isSidebarOpen">{{ item.title }}</p>

                <!-- Items de Navegaci√≥n -->
                <a *ngIf="!item.isTitle" [routerLink]="item.path!"
                    routerLinkActive="bg-indigo-50 dark:bg-gray-700 text-indigo-700 dark:text-indigo-300 font-semibold shadow-sm"
                    [routerLinkActiveOptions]="{exact: item.path === '/dashboard'}"
                    class="flex items-center p-3 mx-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150 group cursor-pointer"
                    [class.justify-center]="!isSidebarOpen">

                    <span class="flex-shrink-0">{{ item.icon }}</span>

                    <span class="ml-3 transition-opacity duration-300 whitespace-nowrap" [class.opacity-100]="isSidebarOpen"
                        [class.opacity-0]="!isSidebarOpen" [class.hidden]="!isSidebarOpen">{{ item.title }}</span>
                </a>
            </ng-container>

        </nav>
    </aside>

    <!-- 2. Contenido Principal -->
    <div class="flex-1 flex flex-col transition-all duration-300" [class.ml-64]="isSidebarOpen"
        [class.ml-16]="!isSidebarOpen">

        <!-- Header Fijo Superior -->
        <header
            class="flex-shrink-0 bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700 h-16 flex items-center justify-between px-4 sm:px-6 z-20">

            <!-- Bot√≥n de Toggle del Sidebar -->
            <button (click)="toggleSidebar()"
                class="text-gray-500 dark:text-gray-400 focus:outline-none p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150">
                <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <div class="flex items-center space-x-4">
                <!-- Bot√≥n para cambiar el tema -->
                <button (click)="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none text-gray-500 dark:text-gray-400">
                    <span *ngIf="!themeService.darkMode()">‚òÄÔ∏è</span>
                    <span *ngIf="themeService.darkMode()">üåô</span>
                </button>

                <!-- Men√∫ de Usuario Desplegable (Dropdown) -->
                <div class="relative">
                    <button (click)="toggleUserDropdown()"
                        class="flex items-center space-x-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-150 focus:outline-none"
                        aria-expanded="true" aria-haspopup="true">
                        <!-- Avatar Placeholder -->
                        <div
                            class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-semibold text-sm">
                            P</div>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300 hidden sm:block">Pablo M.</span>
                        <svg class="h-4 w-4 text-gray-400 dark:text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>

                    <!-- Contenido del Dropdown -->
                    <div *ngIf="isUserDropdownOpen"
                        class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl py-1 ring-1 ring-black ring-opacity-5 z-40 origin-top-right transition-all duration-200 ease-out transform">

                        <a (click)="goToProfile()"
                            class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                            <span class="mr-2">üë§</span> Mi Perfil
                        </a>

                        <div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>

                        <a (click)="logout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900 dark:hover:text-red-400 cursor-pointer">
                            <span class="mr-2">‚ùå</span> Cerrar Sesi√≥n
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- √Årea de Contenido Din√°mico (MAIN) -->
        <main class="flex-1 p-4 sm:p-6 overflow-y-auto">
            <!-- CRUCIAL: Aqu√≠ se cargan las vistas de las rutas hijas (/dashboard, /dashboard/home) -->
            <router-outlet></router-outlet>
        </main>
    </div>
</div>